<nz-table
	#basicTable
	[nzData]="protocolEntries()"
	nzSize="small"
	[nzShowPagination]="false"
	[nzFrontPagination]="false"
	[nzTotal]="protocolEntries.length"
	class="table"
	krdNzTableFullHeight
>
	<thead>
		<tr>
			<th class="time">Zeit</th>
			<th class="sender">Von</th>
			<th class="recipient">An</th>
			<th class="message">Nachricht</th>
			<th class="channel">K</th>
		</tr>
	</thead>
	<tbody>
		@for (entry of basicTable.data; track entry.id) {
			<tr>
				<td
					class="time"
					nz-tooltip
					[nzTooltipTitle]="entry.time.toLocaleString()"
				>
					{{ entry.time | krdProtocolEntryTime }}
				</td>
				<td class="sender">
					<krd-unit-chip [unit]="entry.sender" />
				</td>
				<td class="recipient">
					@if (entry.recipient) {
						<krd-unit-chip [unit]="entry.recipient" />
					}
				</td>
				<td class="message">
					@switch (entry.payload.__typename) {
						@case ('CommunicationMessagePayload') {
							{{ entry.payload.message }}
						}
						@case ('RescueStationMessagePayload') {
							Rettungswache
							{{
								entry.__typename === 'RescueStationSignOnMessage'
									? 'Anmeldung'
									: 'Nachmeldung'
							}}: {{ entry.payload.rescueStationName }}; StÃ¤rke:
							{{ entry.payload.strength.leaders }}/{{
								entry.payload.strength.subLeaders
							}}/{{ entry.payload.strength.helpers }}/{{
								entry.payload.strength.leaders +
									entry.payload.strength.subLeaders +
									entry.payload.strength.helpers
							}}
							@if (entry.payload.units.length > 0) {
								; Einheiten:
								@for (
									unit of entry.payload.units;
									track unit.id;
									let last = $last
								) {
									{{ unit.callSign }}
									@if (!last) {
										,
									}
								}
							}
							@if (entry.payload.alertGroups.length > 0) {
								; Alarmgruppen:
								@for (
									alertGroup of entry.payload.alertGroups;
									track alertGroup.id;
									let last = $last
								) {
									{{ alertGroup.name }} (
									@for (
										unit of alertGroup.units;
										track unit.id;
										let last = $last
									) {
										{{ unit.callSign }}
										@if (!last) {
											,
										}
									}
									)
									@if (!last) {
										,
									}
								}
							}
						}
						@case ('RescueStationSignOffMessagePayload') {
							Rettungswache Ausmeldung: {{ entry.payload.rescueStationName }}
						}
						@default {
							{{ entry.searchableText }}
						}
					}
				</td>
				<td class="channel">{{ entry.channel }}</td>
			</tr>
		}
	</tbody>
</nz-table>
